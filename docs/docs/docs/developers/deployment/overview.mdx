---
title: Deployment Overview
description: Guide to deploying Openlane infrastructure and applications using Helm charts
sidebar_position: 1
---

# Deployment Overview

Openlane provides production-ready Helm charts for deploying the complete platform on Kubernetes, with specialized support for Google Cloud Platform (GCP) infrastructure provisioning through Config Connector.

## Architecture

The deployment architecture uses a GitOps approach powered by **GCP Config Controller**, which includes managed Config Sync and **Config Connector**. This enables unified management of both infrastructure and application resources through Helm charts.

### Core Components

- **GKE Autopilot cluster** - Managed Kubernetes environment
- **Shared VPC** - Network isolation and connectivity
- **DNS and Load Balancing** - Traffic routing and SSL termination
- **CloudSQL** - Managed PostgreSQL database
- **Memorystore Redis** - Caching and session storage
- **External Secrets Operator** - Secret management integration

## Helm Chart Structure

### Main Application Chart

The primary Openlane chart is located at `/charts/openlane/` in the [openlane-infra](https://github.com/theopenlane/openlane-infra) repository and includes:

- **Core API server** - Main application services
- **Riverboat workers** - Job queue processing
- **RiverUI** - Job monitoring interface
- **OpenFGA integration** - Authorization service
- **External secrets** - GCP Secret Manager integration

### Infrastructure Charts

Infrastructure components are provided as separate charts that can be included as dependencies:

- `cert-manager` - SSL certificate management
- `external-dns` - Automatic DNS record management
- `gcp-*` charts - GCP resource provisioning (VPC, CloudSQL, Redis, etc.)
- `grafana` - Monitoring and observability
- `prometheus` - Metrics collection

## Configuration

### Core Application Configuration

The main application is configured through the `values.yaml` file with comprehensive settings:

```yaml
openlane:
  replicaCount: 3
  image:
    repository: ghcr.io/theopenlane/core
    tag: "v0.24.0"
    pullPolicy: IfNotPresent

  # Database configuration
  secretEnv:
    CORE_DB_PRIMARYDBSOURCE: ""
    CORE_JOBQUEUE_CONNECTIONURI: ""
    OPENFGA_DATASTORE_URI: ""

  # Application settings
  coreConfiguration:
    domain: ""
    server:
      listen: ":17608"
      metricsPort: ":17609"
      tls:
        enabled: false
      cors:
        enabled: true
        allowOrigins: []
```

### Infrastructure Configuration

Infrastructure resources are configured using Config Connector CRDs:

```yaml
# Example CloudSQL configuration
apiVersion: sql.cnrm.cloud.google.com/v1beta1
kind: SQLInstance
metadata:
  name: openlane-postgres
spec:
  databaseVersion: POSTGRES_15
  region: us-central1
  settings:
    tier: db-f1-micro
    availabilityType: ZONAL
```

## Deployment Methods

### Option 1: GKE with Config Controller (Recommended)

For production deployments on GCP:

1. **Enable Config Controller** on your GKE cluster
2. **Configure Config Sync** to monitor your GitOps repository
3. **Deploy infrastructure charts** first (VPC, CloudSQL, etc.)
4. **Deploy application charts** with proper dependencies

```bash
# Example deployment command
helm install openlane ./charts/openlane \
  --namespace openlane-system \
  --create-namespace \
  --values production-values.yaml
```

### Option 2: Standard Kubernetes

For deployments on other Kubernetes providers:

1. **Create necessary secrets** manually or via external tools
2. **Deploy external dependencies** (PostgreSQL, Redis)
3. **Configure ingress** and certificate management
4. **Deploy Openlane chart** with appropriate values

```bash
# Install with external database
helm install openlane ./charts/openlane \
  --set openlane.cloudsql.enabled=false \
  --set openlane.secretEnv.CORE_DB_PRIMARYDBSOURCE="postgres://..." \
  --values kubernetes-values.yaml
```

## Required Services

### Database (PostgreSQL)

Openlane requires a PostgreSQL 12+ database. Options include:

- **GCP CloudSQL** (recommended for GCP deployments)
- **Amazon RDS** (for AWS deployments)
- **Azure Database** (for Azure deployments)
- **Self-managed PostgreSQL** (for on-premises)

### Cache (Redis)

Redis is used for session storage and feature authorization caching:

- **GCP Memorystore** (recommended for GCP deployments)
- **Amazon ElastiCache** (for AWS deployments)
- **Azure Cache** (for Azure deployments)
- **Self-managed Redis** (for on-premises)

### Authorization (OpenFGA)

OpenFGA handles fine-grained authorization:

```yaml
# OpenFGA configuration
openlane:
  coreConfiguration:
    authz:
      enabled: true
      hostUrl: "https://authz.theopenlane.io"
      storeName: "openlane"
```

### Job Queue (River)

Riverboat provides job queue functionality:

```yaml
riverboat:
  replicaCount: 2
  image:
    repository: ghcr.io/theopenlane/riverboat
    tag: amd64-latest
  riverDatabaseHost: ""
```

## Secret Management

### External Secrets Operator

Openlane integrates with External Secrets Operator for secret management:

```yaml
openlane:
  externalSecrets:
    enabled: true
    secrets:
      core-subscription-privatestripekey:
        enabled: true
        secretKey: "CORE_SUBSCRIPTION_PRIVATESTRIPEKEY"
        remoteKey: "core-subscription-privatestripekey"
```

### Manual Secret Creation

For non-GCP deployments, create secrets manually:

```bash
kubectl create secret generic openlane-app-secret \
  --from-literal=CORE_DB_PRIMARYDBSOURCE="postgres://..." \
  --from-literal=CORE_SESSIONS_SIGNINGKEY="..." \
  --from-literal=CORE_SESSIONS_ENCRYPTIONKEY="..."
```

## Monitoring and Observability

### Prometheus Integration

The chart includes PodMonitor resources for Prometheus:

```yaml
podMonitor:
  enabled: true
  interval: "30s"
  additionalLabels:
    monitoring: "true"
```

### Health Checks

Built-in health check endpoints:

- `/healthz` - Application health
- `/readyz` - Readiness probe
- `:17609/metrics` - Prometheus metrics

## Scaling Configuration

### Horizontal Pod Autoscaling

Configure HPA for the core application:

```yaml
openlane:
  replicaCount: 3
  # Additional HPA configuration would go in a separate HPA resource
```

### Database Scaling

For CloudSQL, configure appropriate machine types:

```yaml
# In your infrastructure values
gcp-cloudsql-postgresql:
  instance:
    tier: db-custom-2-8192  # 2 vCPU, 8GB RAM
    diskSize: 100
    diskType: PD_SSD
```

## Networking

### Ingress Configuration

Configure ingress for external access:

```yaml
openlane:
  ingress:
    enabled: true
    className: "gce"
    hosts:
      - host: "api.your-domain.com"
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: api-tls
        hosts:
          - api.your-domain.com
```

### CORS Configuration

Configure CORS for web applications:

```yaml
openlane:
  coreConfiguration:
    server:
      cors:
        enabled: true
        allowOrigins:
          - "https://console.your-domain.com"
          - "https://your-domain.com"
```

## Security

### TLS Configuration

Enable TLS for production deployments:

```yaml
openlane:
  coreConfiguration:
    server:
      tls:
        enabled: true
        certFile: "/etc/certs/tls.crt"
        certKey: "/etc/certs/tls.key"
```

### CSRF Protection

Enable CSRF protection for web traffic:

```yaml
openlane:
  coreConfiguration:
    server:
      csrfProtection:
        enabled: true
        cookie: "ol.csrf-token"
        secure: true
        sameSite: "Strict"
```

## Development vs Production

### Development Configuration

For local development:

```yaml
openlane:
  coreConfiguration:
    server:
      dev: true
      cors:
        cookieInsecure: true
    tracer:
      enabled: true
      provider: "stdout"
```

### Production Configuration

For production deployments:

```yaml
openlane:
  replicaCount: 3
  coreConfiguration:
    server:
      dev: false
      secure:
        enabled: true
        hstspreloadenabled: true
    tracer:
      enabled: true
      provider: "otlp"
      otlp:
        endpoint: "your-otel-collector:4317"
```

## Backup and Disaster Recovery

### Database Backups

Configure automatic CloudSQL backups:

```yaml
gcp-cloudsql-postgresql:
  instance:
    backupConfiguration:
      enabled: true
      startTime: "03:00"
      retainedBackups: 30
```

### Configuration Backups

Store Helm values and configurations in version control:

```bash
# Export current configuration
helm get values openlane > current-values.yaml

# Store in Git repository for versioning
git add current-values.yaml
git commit -m "Update production configuration"
```

## Troubleshooting

### Common Issues

1. **Pod startup failures** - Check secret availability and database connectivity
2. **Database connection errors** - Verify CloudSQL proxy or connection strings
3. **Authorization failures** - Ensure OpenFGA is properly configured
4. **Job processing issues** - Check Riverboat worker configuration

### Debugging Commands

```bash
# Check pod logs
kubectl logs -f deployment/openlane-core

# Check secret creation
kubectl get secrets openlane-app-secret -o yaml

# Verify external secrets
kubectl get externalsecrets

# Check database connectivity
kubectl exec -it deployment/openlane-core -- /openlane version
```

## Chart Development

### Local Testing

Test charts locally using:

```bash
# Lint the chart
helm lint ./charts/openlane

# Template and check output
helm template openlane ./charts/openlane --values test-values.yaml

# Dry run deployment
helm install openlane ./charts/openlane --dry-run --debug
```

### Chart Dependencies

Update dependencies before deployment:

```bash
# Update chart dependencies
helm dependency update ./charts/openlane

# Verify dependency versions
helm dependency list ./charts/openlane
```

This deployment guide provides the foundation for running Openlane in production environments. For specific cloud provider configurations and advanced deployment scenarios, refer to the individual chart documentation in the [openlane-infra repository](https://github.com/theopenlane/openlane-infra).